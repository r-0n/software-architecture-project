graph LR
  %% Title
  %% Implementation: Package / Module Diagram

  subgraph src
    subgraph retail
      R1[settings.py]
      R2[middleware.py]
      R3[logging.py]
      R4[payment.py]
      R5[urls.py]
      R6[wsgi.py]
      R7[asgi.py]
      R8[management/commands/replay_requests.py]
    end

    subgraph accounts
      A1[models.py]
      A2[views.py]
      A3[forms.py]
      A4[decorators.py]
      A5[context_processors.py]
      A6[admin.py]
      A7[urls.py]
    end

    subgraph products
      P1[models.py]
      P2[views.py]
      P3[services.py]
      P4[forms.py]
      P5[admin.py]
      P6[urls.py]
      P7[management/commands/create_sample_data.py]
    end

    subgraph cart
      C1[models.py]
      C2[views.py]
      C3[business_rules.py]
      C4[forms.py]
      C5[throttle.py]
      C6[urls.py]
    end

    subgraph orders
      O1[models.py]
      O2[views.py]
      O3[urls.py]
    end

    subgraph payments
      PM1[client.py]
      PM2[policy.py]
      PM3[service.py]
    end

    subgraph partner_feeds
      PF1[models.py]
      PF2[views.py]
      PF3[services.py]
      PF4[adapters.py]
      PF5[validators.py]
      PF6[admin.py]
      PF7[urls.py]
      PF8[tests.py]
    end

    subgraph worker
      W1[queue.py]
      W2[management/commands/run_queue.py]
      W3[apps.py]
    end

    subgraph ingestion_worker
      IW1[models.py]
      IW2[views.py]
      IW3[admin.py]
      IW4[tests.py]
      IW5[apps.py]
    end
  end

  subgraph tests
    T1[test_business_logic.py]
    T2[test_database_integration.py]
    T3[test_order_processing_robustness.py]
    T4[test_quality_scenarios.py]
    T5[test_record_playback.py]
  end

  %% Dependencies
  cart --> products : uses Product models & services
  cart --> orders : uses Sale/Payment models
  cart --> payments : triggers PaymentService
  cart --> worker : enqueues jobs
  cart --> retail : uses logging & payment
  products --> accounts : uses admin_required decorator
  products --> cart : uses Cart model
  orders --> products : uses Product model
  payments --> retail : uses logging
  partner_feeds --> products : upserts Product/Category
  worker --> retail : uses logging
  tests --> cart : tests Cart operations
  tests --> products : tests Product operations
  tests --> orders : tests Order operations
  tests --> payments : tests Payment resilience
  tests --> partner_feeds : tests Feed ingestion
  tests --> retail : tests Payment processing

  %% Legend
  %% --> dependency/import
  %% subgraphs represent Python packages (apps)
